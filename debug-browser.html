<!DOCTYPE html>
<html>
<head>
    <title>Debug Solicitor Brain</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        iframe { width: 100%; height: 400px; border: 2px solid #333; }
        pre { background: #f0f0f0; padding: 10px; overflow: auto; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Debug Solicitor Brain v2</h1>
    
    <h2>Application Frame</h2>
    <iframe id="app-frame" src="http://localhost:5173"></iframe>
    
    <h2>Console Output</h2>
    <pre id="console-output"></pre>
    
    <h2>Network Requests</h2>
    <pre id="network-output"></pre>

    <script>
        const output = document.getElementById('console-output');
        const networkOutput = document.getElementById('network-output');
        
        // Intercept console logs from iframe
        window.addEventListener('message', (event) => {
            if (event.origin === 'http://localhost:5173') {
                output.textContent += event.data + '\n';
            }
        });
        
        // Try to access the iframe
        const iframe = document.getElementById('app-frame');
        iframe.onload = () => {
            output.textContent += 'Iframe loaded\n';
            
            // Try to inject console interceptor
            try {
                const script = iframe.contentDocument.createElement('script');
                script.textContent = `
                    const originalLog = console.log;
                    const originalError = console.error;
                    console.log = function(...args) {
                        originalLog.apply(console, args);
                        parent.postMessage('LOG: ' + args.join(' '), '*');
                    };
                    console.error = function(...args) {
                        originalError.apply(console, args);
                        parent.postMessage('ERROR: ' + args.join(' '), '*');
                    };
                    console.log('Console interceptor installed');
                `;
                iframe.contentDocument.head.appendChild(script);
            } catch (e) {
                output.textContent += 'Cannot access iframe (CORS): ' + e + '\n';
            }
        };
        
        // Check API
        fetch('http://localhost:3333/api/health')
            .then(res => res.json())
            .then(data => {
                networkOutput.textContent += 'API Health: ' + JSON.stringify(data, null, 2) + '\n';
            })
            .catch(err => {
                networkOutput.textContent += 'API Error: ' + err + '\n';
            });
            
        // Check login endpoint
        fetch('http://localhost:5173/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username: 'test', password: 'test' })
        })
            .then(res => res.text())
            .then(text => {
                networkOutput.textContent += '\nLogin endpoint response:\n' + text.substring(0, 500) + '\n';
            })
            .catch(err => {
                networkOutput.textContent += '\nLogin endpoint error: ' + err + '\n';
            });
    </script>
</body>
</html>